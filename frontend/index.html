<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conciliador SPED</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="content-wrapper">
        <header class="top-bar">
            <span class="top-bar-title">游늵 Dashboard de Concilia칞칚o Fiscal</span>
        </header>
        
        <main class="content">
            <div class="card card-upload">
                <h2>Iniciar Nova An치lise</h2>
                <div id="upload-area">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="file_sped">1. Arquivo SPED (.txt)</label>
                            <input type="file" id="file_sped" name="file_sped" accept=".txt" required>
                        </div>
                        <div class="form-group">
                            <label for="file_livro">2. Livro Fiscal (.pdf)</label>
                            <input type="file" id="file_livro" name="file_livro" accept=".pdf" required>
                        </div>
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="manual-mode-checkbox">
                        <label for="manual-mode-checkbox">J치 tenho os 3 relat칩rios PDF gerados pelo PVA.</label>
                    </div>

                    <div id="manual-upload-area" class="hidden">
                        <div class="form-row">
                             <div class="form-group">
                                <label for="file_entradas_pdf">3. Relat칩rio de Entradas (.pdf)</label>
                                <input type="file" id="file_entradas_pdf" name="file_entradas_pdf" accept=".pdf">
                            </div>
                            <div class="form-group">
                                <label for="file_saidas_pdf">4. Relat칩rio de Sa칤das (.pdf)</label>
                                <input type="file" id="file_saidas_pdf" name="file_saidas_pdf" accept=".pdf">
                            </div>
                            <div class="form-group">
                                <label for="file_apuracao_pdf">5. Relat칩rio de Apura칞칚o (.pdf)</label>
                                <input type="file" id="file_apuracao_pdf" name="file_apuracao_pdf" accept=".pdf">
                            </div>
                        </div>
                    </div>

                    <div class="button-row">
                        <button type="button" id="btn-processar-tudo">
                            <span id="btn-text-processar">Processar An치lise Completa</span>
                            <div id="loader-processar" class="loader hidden"></div>
                        </button>
                    </div>
                    <div id="status-message-geral" class="status" aria-live="polite"></div>
                </div>
            </div>

            <div class="toggle-wrapper">
                <button type="button" id="btn-toggle-avancado" class="btn-toggle">Mostrar Extra칞칚o Avan칞ada (Apura칞칚o SPED)</button>
            </div>
            
            <div id="card-extracao-avancada" class="card-resultado card-largo aguardando hidden">
                <div class="card-header">
                    <h3>Extra칞칚o Avan칞ada (Relat칩rio SPED)</h3>
                    <div id="status-extracao-avancada" class="status-box">Aguardando...</div>
                </div>
                
                <div class="card-body">
                    <p>Selecione os campos do Relat칩rio de Apura칞칚o do SPED que voc칡 deseja extrair. Os valores Padr칚o (Recolher/Saldo) j치 s칚o exibidos abaixo.</p>
                    <div class="checkbox-grid">
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_DEBITO_SAIDAS" value="AP_DEBITO_SAIDAS">
                            <label for="chk_AP_DEBITO_SAIDAS">SA칈DAS E PRESTA칂칏ES COM D칄BITO DO IMPOSTO</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_AJUSTES_DEBITO_DOC" value="AP_AJUSTES_DEBITO_DOC">
                            <label for="chk_AP_AJUSTES_DEBITO_DOC">VALOR TOTAL DOS AJUSTES A D칄BITO (decorrentes do documento fiscal)</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_AJUSTES_DEBITO_IMP" value="AP_AJUSTES_DEBITO_IMP">
                            <label for="chk_AP_AJUSTES_DEBITO_IMP">VALOR TOTAL DOS AJUSTES A D칄BITO DO IMPOSTO</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_ESTORNO_CREDITOS" value="AP_ESTORNO_CREDITOS">
                            <label for="chk_AP_ESTORNO_CREDITOS">VALOR TOTAL DOS ESTORNOS DE CR칄DITOS</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_CREDITO_ENTRADAS" value="AP_CREDITO_ENTRADAS">
                            <label for="chk_AP_CREDITO_ENTRADAS">VALOR TOTAL DOS CR칄DITOS POR ENTRADAS E AQUISI칂칏ES COM CR칄DITO DO IMPOSTO</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_AJUSTES_CREDITO_DOC" value="AP_AJUSTES_CREDITO_DOC">
                            <label for="chk_AP_AJUSTES_CREDITO_DOC">VALOR TOTAL DOS AJUSTES A CR칄DITO (decorrentes do documento fiscal)</label>
                        </div>
                         <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_AJUSTES_CREDITO_IMP" value="AP_AJUSTES_CREDITO_IMP">
                            <label for="chk_AP_AJUSTES_CREDITO_IMP">VALOR TOTAL DOS AJUSTES A CR칄DITO DO IMPOSTO</label>
                        </div>
                         <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_ESTORNO_DEBITOS" value="AP_ESTORNO_DEBITOS">
                            <label for="chk_AP_ESTORNO_DEBITOS">VALOR TOTAL DOS ESTORNOS DE D칄BITOS</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_SALDO_ANTERIOR" value="AP_SALDO_ANTERIOR">
                            <label for="chk_AP_SALDO_ANTERIOR">VALOR TOTAL DO SALDO CREDOR DO periodo ANTERIOR</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_SALDO_DEVEDOR" value="AP_SALDO_DEVEDOR">
                            <label for="chk_AP_SALDO_DEVEDOR">VALOR DO SALDO DEVEDOR</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_DEDUCOES" value="AP_DEDUCOES">
                            <label for="chk_AP_DEDUCOES">VALOR TOTAL DAS DEDU칂칏ES</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_RECOLHER" value="AP_RECOLHER">
                            <label for="chk_AP_RECOLHER">VALOR TOTAL DO ICMS A RECOLHER</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_SALDO_CREDOR" value="AP_SALDO_CREDOR">
                            <label for="chk_AP_SALDO_CREDOR">VALOR TOTAL DO SALDO CREDOR A TRANSPORTAR PARA O per칤odo SEGUINTE</label>
                        </div>
                        <div>
                            <input type="checkbox" class="chk-avancado" id="chk_AP_EXTRA_APURACAO" value="AP_EXTRA_APURACAO">
                            <label for="chk_AP_EXTRA_APURACAO">VALORES RECOLHIDOS OU A RECOLHER, EXTRA-APURA칂츾O</label>
                        </div>
                    </div>

                    <div class="tabela-container" style="height: auto; max-height: 400px; margin-top: 20px;">
                        <table id="tabela-apuracao-avancada">
                            <thead>
                                <tr>
                                    <th>Campo Solicitado</th>
                                    <th>Valor (Relat칩rio SPED)</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-apuracao-avancada-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <h2>Resultados da Concilia칞칚o de Totais</h2>
            <div class="dashboard-grid">
                <div id="card-entradas" class="card-resultado card-largo aguardando">
                    <div class="card-header">
                        <h3>Concilia칞칚o de Entradas</h3>
                        <div id="resultado-entradas" class="status-box">Aguardando...</div>
                    </div>
                    <div class="card-body card-body-apuracao">
                        <div class="coluna">
                            <h4>Relat칩rio SPED</h4>
                            <p>Total Opera칞칚o: <span id="sped-e-total">--</span></p>
                            <p>Base de C치lculo ICMS: <span id="sped-e-bc">--</span></p>
                            <p>Total ICMS: <span id="sped-e-icms">--</span></p>
                        </div>
                        <div class="coluna">
                            <h4>Livro Fiscal</h4>
                            <p>Total Opera칞칚o: <span id="livro-e-total">--</span></p>
                            <p>Base de C치lculo ICMS: <span id="livro-e-bc">--</span></p>
                            <p>Total ICMS: <span id="livro-e-icms">--</span></p>
                        </div>
                        <div class="coluna-status">
                            <div id="status-e-total" class="status-box-mini">Aguardando...</div>
                            <div id="status-e-bc" class="status-box-mini">Aguardando...</div>
                            <div id="status-e-icms" class="status-box-mini">Aguardando...</div>
                        </div>
                    </div>
                </div>
                <div id="card-saidas" class="card-resultado card-largo aguardando">
                     <div class="card-header">
                        <h3>Concilia칞칚o de Sa칤das</h3>
                        <div id="resultado-saidas" class="status-box">Aguardando...</div>
                    </div>
                    <div class="card-body card-body-apuracao">
                        <div class="coluna">
                            <h4>Relat칩rio SPED</h4>
                            <p>Total Opera칞칚o: <span id="sped-s-total">--</span></p>
                            <p>Base de C치lculo ICMS: <span id="sped-s-bc">--</span></p>
                            <p>Total ICMS: <span id="sped-s-icms">--</span></p>
                        </div>
                        <div class="coluna">
                            <h4>Livro Fiscal</h4>
                            <p>Total Opera칞칚o: <span id="livro-s-total">--</span></p>
                            <p>Base de C치lculo ICMS: <span id="livro-s-bc">--</span></p>
                            <p>Total ICMS: <span id="livro-s-icms">--</span></p>
                        </div>
                        <div class="coluna-status">
                            <div id="status-s-total" class="status-box-mini">Aguardando...</div>
                            <div id="status-s-bc" class="status-box-mini">Aguardando...</div>
                            <div id="status-s-icms" class="status-box-mini">Aguardando...</div>
                        </div>
                    </div>
                </div>
                
                <div id="card-apuracao" class="card-resultado card-largo aguardando">
                    <div class="card-header"><h3>Apura칞칚o de ICMS (Opera칞칫es Pr칩prias)</h3></div>
                    <div class="card-body-apuracao">
                        <div class="coluna">
                            <h4>Valores do Relat칩rio SPED</h4>
                            <p>Total a Recolher: <span id="sped-a1">--</span></p>
                            <p>Saldo Credor: <span id="sped-a2">--</span></p>
                        </div>
                        <div class="coluna">
                            <h4>Valores do Livro Fiscal</h4>
                            <p>C칩digo 013 (Livro): <span id="livro-a1">--</span></p>
                            <p>C칩digo 014 (Livro): <span id="livro-a2">--</span></p>
                        </div>
                        <div class="coluna-status">
                            <div id="resultado-apuracao-1" class="status-box-mini">Aguardando...</div>
                            <div id="resultado-apuracao-2" class="status-box-mini">Aguardando...</div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>Alertas de An치lise (E111)</h2>
            <div class="dashboard-grid">
                 <div id="card-alertas" class="card-resultado card-largo aguardando">
                    <div class="card-header">
                        <h3>Verifica칞칚o de C칩digos E111 (SPED vs. Livro)</h3>
                        <div id="status-alertas" class="status-box">Aguardando...</div>
                    </div>
                    <div class="card-body">
                        <p>Verificamos se todos os c칩digos <code>|E111|</code> do SPED existem no Livro Fiscal.</p>
                        <ul id="lista-alertas-codigos"></ul>
                    </div>
                </div>
            </div>
            
            <h2>Concilia칞칚o de Ajustes Detalhados</h2>
            <div class="dashboard-grid">
                <div id="card-detalhe-e116" class="card-resultado card-largo aguardando">
                    <div class="card-header">
                        <h3>SPED E116 vs. Livro "Informa칞칫es Complementares"</h3>
                        <div id="status-detalhe-e116" class="status-box">Aguardando...</div>
                    </div>
                    <div class="card-body-apuracao">
                         <div class="coluna">
                            <h4>SPED (.txt)</h4>
                            <p>Soma dos Registros |E116|: <span id="sped-e116-soma">--</span></p>
                        </div>
                       <div class="coluna">
                            <h4>Livro Fiscal (.pdf)</h4>
                            <p>Soma "Informa칞칫es Complementares": <span id="livro-infcomp-soma">--</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <h2>An치lise Manual (Bloco E vs. Detalhamento)</h2>
            <div class="dashboard-grid">
                <div id="card-detalhamento" class="card-resultado card-largo aguardando">
                    <div class="card-header">
                        <h3>Bloco E (.txt) vs. Totais por C칩digo (.pdf)</h3>
                        <div id="status-detalhamento" class="status-box">Aguardando...</div>
                    </div>
                    <div class="card-body-detalhamento">
                        <div class="coluna-detalhe">
                            <h4>Bloco E extra칤do do SPED (.txt)</h4>
                            <div class="bloco-e-filtros" id="bloco-e-filtros">
                                <button class="filtro-btn active" data-filtro="todos">Todos</button>
                                <button class="filtro-btn" data-filtro="reg-e110">E110</button>
                                <button class="filtro-btn" data-filtro="reg-e111">E111</button>
                                <button class="filtro-btn" data-filtro="reg-e116">E116</button>
                            </div>
                            <div class="tabela-container" id="bloco-e-table-wrapper">
                                <table id="bloco-e-table"><tbody id="bloco-e-table-body"></tbody></table>
                            </div>
                        </div>
                        <div class="coluna-detalhe">
                            <h4>Totais por C칩digo do Livro (.pdf)</h4>
                             <div class="tabela-container">
                                <table id="detalhamento-table"><tbody id="detalhamento-table-body"></tbody></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div> 

    <script src="app.js"></script>
</body>
</html>